###############
Getting started
###############

********
Overview
********

What
  The :abbr:`GWAS(Genome-wide association study)` database was created for storing all data used in genome-wide association studies in the Baxter Lab. The database currently contains the complete dataset for the Maize 282 population.  This document describes the current setup, schema, access, backups, and other relevant information pertaining to the database as of September 1, 2018

Why
  The primary aim of the database is to store the data in a single location and thereby facilitate efficient analysis and processing of the data.

Where
  The database is hosted on a CentOS 7 virtual machine on the Danforth Center Bioinformatics infrastructure.  The VM is called ``adriatic`` and its hostname is ``adriatic.ddpsc.org``. The source files can be found on GitHub at https://github.com/tparkerd/gwas_database.git.

How
  Diagrams and details on implementation can be found in the :ref:`Database <database>` section

***********
Environment
***********

This software is compatible with PostgreSQL Releases 9.4, 9.5, and 9.6 on GNU/Linux x86_64. It has been tested on CentOS 6 and CentOS 7. Older versions of PostgreSQL will not work because of usage of ``'WITH ORDINALITY'``, and newer versions will not work because of incompatibility with the current state of the ``TINYINT`` library. [1]_

Current Specifications
  :OS: CentOS 7
  :RDBMS: PostgreSQL 9.6
  :Source code: ``/opt/BaxDB``

**************************
Connecting to ``adriatic``
**************************

.. danger::
  This is the **production** environment.

The database is hosted on a virtual machine on the Danforth Center Bioinformatics infrastructure known as ``adriatic``.

  :host: ``adriatic.ddpsc.org``, ``10.5.1.33``
  :port: 5432
  :database name: ``baxdb``

New users
=========

.. seealso::
  :ref:`Create a local instance of GWAS database <installation>`

To allow a new user to access ``adriatic``, their bioinformatics username must be added to the last line (AllowUsers) of a file called ``sshd_config`` located in ``/etc/ssh``.  To edit this file, a user must have sudo access on adriatic.  Otherwise `Josh Rothhaupt`_ from Bioinformatics can make the necessary change to allow a new user.

A separate database user role must be created for access as a userâ€™s bioinformatics credentials do not provide access to ``baxdb``.  `Greg Zielger`_ and `Josh Rothhaupt`_ both have permissions to create new roles (users) in the database. Once a user role has been created for a new user, they will also have to be granted the proper permissions to access ``baxdb`` and the tables/indices/etc. within the database.

.. important::
  In order to connect to ``adriatic``, you must first ``ssh`` into ``stargate``, the login server for the bioinformatics.

*******
Backups
*******

.. warning::
  Backups are kept for **one week**, then discarded.

The database is backed up daily using ``pg_dump``, a PostgreSQL backup utility. The backups and the script for backing up the database are located in ``/opt/dbBackups``.  The script ``backupBaxDB.sh`` runs daily in a cron job.  Backups generated with ``pg_dump`` are stored in ``/opt/dbBackups/BaxDBbackups``.  The archives generated by ``pg_dump`` can be used to restore a database using the ``pg_restore`` utility.

******************
Transferring Files
******************

``stargate``
==========
  Stargate is the login server for the bioinformatics system. `Josh Rothhaupt`_ should have created a new account for you during onboarding, but if not, email him to request an account.

The home directory for ``stargate`` and ``adriatic`` is a shared directory. So the contents of ``/home/<username>`` will be the same regardless of which you are currently logged into. Therefore, if you need to copy anything from Adriatic to your local machine, first copy it into your home directory on Adriatic and then ``sftp`` into Stargate.

Additional information on the bioinformatics system can be found at https://bioinformatics.readthedocs.io/.

External Resources
  - `Genome-wide association studies`_ --- Wikipedia
  - `GWAS Database Synopsis`_ --- Google Drive

References
  .. [1] https://github.com/rlichtenwalter/pgsql_genomics

.. _Genome-wide association studies: https://en.wikipedia.org/wiki/Genome-wide_association_study
.. _GWAS Database Synopsis: https://docs.google.com/document/d/1womNvi6FvGdQ636OSNpP6-Z6Sa3U1anNVlhdTU8K700/edit
.. _Josh Rothhaupt: mailto:jrothhaupt@danforthcenter.org
.. _Greg Zielger: mailto:gzielger@danforthcenter.org
